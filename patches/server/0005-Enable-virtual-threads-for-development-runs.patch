From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Martijn Muijsers <martijnmuijsers@live.nl>
Date: Mon, 13 Feb 2023 21:18:44 +0100
Subject: [PATCH] Enable virtual threads for development runs

License: GPL-3.0 (https://www.gnu.org/licenses/gpl-3.0.html)
Gale - https://galemc.org

diff --git a/build.gradle.kts b/build.gradle.kts
index 1f7d0aa2d36b59c23a04e94dc117da987bc1a0b2..2d031cf2b1f481b0812ea2e60e69b9a29f78d497 100644
--- a/build.gradle.kts
+++ b/build.gradle.kts
@@ -182,6 +182,12 @@ fun TaskContainer.registerRunTask(
     val memoryGb = providers.gradleProperty("paper.runMemoryGb").getOrElse("2")
     minHeapSize = "${memoryGb}G"
     maxHeapSize = "${memoryGb}G"
+    val modifiedJvmArgs = jvmArgs ?: arrayListOf()
+    // Gale start - enable virtual threads for development runs
+    modifiedJvmArgs.add("--enable-preview")
+    modifiedJvmArgs.addAll(listOf("--add-opens=java.base/java.lang=ALL-UNNAMED"))
+    // Gale end - enable virtual threads for development runs
+    jvmArgs = modifiedJvmArgs
 
     doFirst {
         workingDir.mkdirs()
